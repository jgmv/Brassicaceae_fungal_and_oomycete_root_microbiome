col[dif_abund_fu$Padj < 0.01] <- "red"
col[is.na(col)] <- "gray"
plot(sel$logcoef ~ sel$logreads, pch = 16, cex = 0.5, col = col)
plot(sel$coef ~ sel$reads, pch = 16, cex = 0.5, col = col)
dif_abund_fu[dif_abund_fu$Padj < 0.001, ]
#x <- na.omit(x)
nrow(dif_abund_fu)
nrow(dif_abund_fu[dif_abund_fu$comp == "endosphere", ])
nrow(dif_abund_fu[dif_abund_fu$comp == "endosphere" & as.numeric(dif_abund_fu$coef) > 0, ])
nrow(dif_abund_fu[dif_abund_fu$comp == "root" & as.numeric(dif_abund_fu$coef) > 0, ])
nrow(dif_abund_fu[dif_abund_fu$comp == "endosphere" & as.numeric(dif_abund_fu$coef) < 0, ])
nrow(dif_abund_fu[dif_abund_fu$comp == "root" & as.numeric(dif_abund_fu$coef) < 0, ])
p_cutoff <- 0.01
x <- dif_abund_fu[dif_abund_fu$Padj <= p_cutoff, ]
x_endo_h <- x[x$comp == "endosphere" & x$coef > 0, ]
x_endo_l <- x[x$comp == "endosphere" & x$coef < 0, ]
x_root_h <- x[x$comp == "root" & x$coef > 0, ]
x_root_l <- x[x$comp == "root" & x$coef < 0, ]
x_rhizo_h <- x[x$comp == "rhizosphere" & x$coef > 0, ]
x_rhizo_l <- x[x$comp == "rhizosphere" & x$coef < 0, ]
dif_coeff <- data.frame(
  rhizosphere = as.numeric(dif_abund_fu[dif_abund_fu$comp == "rhizosphere",
  "coef"]), root = as.numeric(dif_abund_fu[dif_abund_fu$comp == "root",
  "coef"]), endosphere = as.numeric(dif_abund_fu[dif_abund_fu$comp ==
  "endosphere", "coef"]))
dif_coeff <- as.matrix(dif_coeff)
rownames(dif_coeff) <- unique(dif_abund_fu$ASV)
dif_abund_fu
x
dif_abund_fu <- x
dif_abund_fu[dif_abund_fu$Padj < 0.001, ]
#x <- na.omit(x)
nrow(dif_abund_fu)
nrow(dif_abund_fu[dif_abund_fu$comp == "endosphere", ])
nrow(dif_abund_fu[dif_abund_fu$comp == "endosphere" & as.numeric(dif_abund_fu$coef) > 0, ])
nrow(dif_abund_fu[dif_abund_fu$comp == "root" & as.numeric(dif_abund_fu$coef) > 0, ])
nrow(dif_abund_fu[dif_abund_fu$comp == "endosphere" & as.numeric(dif_abund_fu$coef) < 0, ])
nrow(dif_abund_fu[dif_abund_fu$comp == "root" & as.numeric(dif_abund_fu$coef) < 0, ])
dif_abund_fu[dif_abund_fu$Padj < 0.001, ]
#x <- na.omit(x)
nrow(dif_abund_fu)
nrow(dif_abund_fu[dif_abund_fu$comp == "endosphere", ])
nrow(dif_abund_fu[dif_abund_fu$comp == "endosphere" & as.numeric(dif_abund_fu$coef) > 0, ])
nrow(dif_abund_fu[dif_abund_fu$comp == "root" & as.numeric(dif_abund_fu$coef) > 0, ])
nrow(dif_abund_fu[dif_abund_fu$comp == "endosphere" & as.numeric(dif_abund_fu$coef) < 0, ])
nrow(dif_abund_fu[dif_abund_fu$comp == "root" & as.numeric(dif_abund_fu$coef) < 0, ])
p_cutoff <- 0.01
x <- dif_abund_fu[dif_abund_fu$Padj <= p_cutoff, ]
x_endo_h <- x[x$comp == "endosphere" & x$coef > 0, ]
x_endo_l <- x[x$comp == "endosphere" & x$coef < 0, ]
x_root_h <- x[x$comp == "root" & x$coef > 0, ]
x_root_l <- x[x$comp == "root" & x$coef < 0, ]
x_rhizo_h <- x[x$comp == "rhizosphere" & x$coef > 0, ]
x_rhizo_l <- x[x$comp == "rhizosphere" & x$coef < 0, ]
dif_coeff <- data.frame(
  rhizosphere = as.numeric(dif_abund_fu[dif_abund_fu$comp == "rhizosphere",
  "coef"]), root = as.numeric(dif_abund_fu[dif_abund_fu$comp == "root",
  "coef"]), endosphere = as.numeric(dif_abund_fu[dif_abund_fu$comp ==
  "endosphere", "coef"]))
head(x)
nrow(x)
dif_abund_fu <-  <- dif_abund(cdm_fu, sample_fu)
dif_abund_fu <- dif_abund(cdm_fu, sample_fu)
sel <- dif_abund_fu[dif_abund_fu$comp == "endosphere", ]
sel <- na.omit(sel)
col <- rep("gray", nrow(sel))
col[dif_abund_fu$Padj < 0.01] <- "red"
col[is.na(col)] <- "gray"
nrow(dif_abund_fu)
plot(sel$logcoef ~ sel$logreads, pch = 16, cex = 0.5, col = col)
dif_abund_fu[dif_abund_fu$Padj < 0.001, ]
#x <- na.omit(x)
nrow(dif_abund_fu)
nrow(dif_abund_fu[dif_abund_fu$comp == "endosphere", ])
nrow(dif_abund_fu[dif_abund_fu$comp == "endosphere" & as.numeric(dif_abund_fu$coef) > 0, ])
nrow(dif_abund_fu[dif_abund_fu$comp == "root" & as.numeric(dif_abund_fu$coef) > 0, ])
nrow(dif_abund_fu[dif_abund_fu$comp == "endosphere" & as.numeric(dif_abund_fu$coef) < 0, ])
nrow(dif_abund_fu[dif_abund_fu$comp == "root" & as.numeric(dif_abund_fu$coef) < 0, ])
dif_abund_fu[dif_abund_fu$Padj < 0.001, ]
#x <- na.omit(x)
nrow(dif_abund_fu)
nrow(dif_abund_fu[dif_abund_fu$comp == "endosphere", ])
nrow(dif_abund_fu[dif_abund_fu$comp == "endosphere" & as.numeric(dif_abund_fu$coef) > 0, ])
nrow(dif_abund_fu[dif_abund_fu$comp == "root" & as.numeric(dif_abund_fu$coef) > 0, ])
nrow(dif_abund_fu[dif_abund_fu$comp == "endosphere" & as.numeric(dif_abund_fu$coef) < 0, ])
nrow(dif_abund_fu[dif_abund_fu$comp == "root" & as.numeric(dif_abund_fu$coef) < 0, ])
p_cutoff <- 0.01
x <- dif_abund_fu[dif_abund_fu$Padj <= p_cutoff, ]
x_endo_h <- x[x$comp == "endosphere" & x$coef > 0, ]
x_endo_l <- x[x$comp == "endosphere" & x$coef < 0, ]
x_root_h <- x[x$comp == "root" & x$coef > 0, ]
x_root_l <- x[x$comp == "root" & x$coef < 0, ]
x_rhizo_h <- x[x$comp == "rhizosphere" & x$coef > 0, ]
x_rhizo_l <- x[x$comp == "rhizosphere" & x$coef < 0, ]
dif_coeff <- data.frame(
  rhizosphere = as.numeric(dif_abund_fu[dif_abund_fu$comp == "rhizosphere",
  "coef"]), root = as.numeric(dif_abund_fu[dif_abund_fu$comp == "root",
  "coef"]), endosphere = as.numeric(dif_abund_fu[dif_abund_fu$comp ==
  "endosphere", "coef"]))
dif_coeff <- as.matrix(dif_coeff)
rownames(dif_coeff) <- unique(dif_abund_fu$ASV)
dif_pval <- data.frame(
  rhizosphere = as.numeric(dif_abund_fu[dif_abund_fu$comp == "rhizosphere",
  "Padj"]), root = as.numeric(dif_abund_fu[dif_abund_fu$comp == "root",
  "Padj"]), endosphere = as.numeric(dif_abund_fu[dif_abund_fu$comp ==
  "endosphere", "Padj"]))
dif_pval <- as.matrix(dif_pval)
rownames(dif_pval) <- unique(dif_abund_fu$ASV)
dif_top <- dif_coeff > 0 & dif_pval <= p_cutoff
dif_low <- dif_coeff < 0 & dif_pval <= p_cutoff
pdf("output/venn_fu2.pdf", w = 4, h = 2, pointsize = 12)
par(mfrow = c(1, 2), mar = rep(1, 4))
venn(dif_top)
venn(dif_low)
dev.off()
### load packages and functions
library(DESeq)
library(gplots)
library(Hmisc)
library(igraph)
library(indicspecies)
#library(iNEXT)
#library(metacoder)
library(mvabund)
#library(phyloseq)
library(RColorBrewer)
library(statmod)
library(vegan)
library(viridis)
# load custom functions
source("input/custom_functions.R")
pdf("output/venn_fu2.pdf", w = 4, h = 2, pointsize = 12)
par(mfrow = c(1, 2), mar = rep(1, 4))
venn(dif_top)
venn(dif_low)
dev.off()
dif_top
venn(na.omit(dif_top))
pdf("output/venn_fu2.pdf", w = 4, h = 2, pointsize = 12)
par(mfrow = c(1, 2), mar = rep(1, 4))
venn(na.omit(dif_top))
venn(na.omit(dif_low))
dev.off()
dif_top <- as.data.frame(dif_top)
dif_low <- as.data.frame(dif_low)
enriched_endo <- rownames(dif_top)[dif_top$endosphere]
enriched_root <- rownames(dif_top)[dif_top$root]
enriched_rhizo <- rownames(dif_top)[dif_top$rhizosphere]
depleted_endo <- rownames(dif_low)[dif_low$endosphere]
depleted_root <- rownames(dif_low)[dif_low$root]
depleted_rhizo <- rownames(dif_low)[dif_low$rhizosphere]
xe <- table(tax_fu[enriched_endo, "order"])
xe <- xe * 100 / sum(xe)
xr <- table(tax_fu[enriched_root, "order"])
xr <- xr * 100 / sum(xr)
xrh <- table(tax_fu[enriched_rhizo, "order"])
xrh <- xrh * 100 / sum(xrh) 
ye <- table(tax_fu[depleted_endo, "order"])
ye <- ye * 100 / sum(ye)
yr <- table(tax_fu[depleted_root, "order"])
yr <- yr * 100 / sum(yr)
yrh <- table(tax_fu[depleted_rhizo, "order"])
yrh <- yrh * 100 / sum(yrh)
z <- cbind(Erh = xrh, Er = xr, Ee = xe, Drh = yrh, Dr = yr, De = ye)
tab <- z[rownames(z) %in% colnames(order_tab_fu), ] 
tab <- rbind(tab, others = colSums(z[!(rownames(z) %in%
  colnames(order_tab_fu)), ]))
tab <- tab[colnames(order_tab_fu), ]
pdf("output/orders_enrich_fu2.pdf", w = 2.4, h = 2.1, pointsize = 12)
par(mar = c(4, 4, 1, 1), xpd = T, tck = -0.03, mgp = c(1.5, 0.5, 0))
barplot(tab, las = 1, col = col_order_fu, ylab = "Proportion", border = NA,
  space = c(0.1, 0.1, 0.1, 0.3, 0.1, 0.1))
dev.off()
head(dif_abund_fu)
enriched_plant <- unique(c(enriched_endo, enriched_root))
endo_tab <- cbind(order = as.character(tax_fu[enriched_plant, "order"]),
  ASV = paste(gsub("_", " ", tax_fu[enriched_plant, "species"]), enriched_plant))
x <- cdm_fu[, enriched_plant]
x <- apply(x, 2, function(x) tapply(x, sample_fu$species, sum))
x[x > 0] <- 1
x <- t(x)
endo_tab <- cbind(endo_tab, x)
endo_tab <- as.data.frame(endo_tab)
endo_tab$in_rhizoplane <- as.numeric(enriched_plant %in% enriched_root)
endo_tab$in_endosphere <- as.numeric(enriched_plant %in% enriched_endo)
write.table(endo_tab, "output/endo_tab_fu.csv", col.names = NA, sep = ";")
enriched_plant <- unique(c(enriched_endo, enriched_root))
enriched_plant
endo_tab <- cbind(order = as.character(tax_fu[enriched_plant, "order"]),
  ASV = paste(gsub("_", " ", tax_fu[enriched_plant, "species"]), enriched_plant))
endo_tab
x <- cdm_fu[, enriched_plant]
 enriched_plant
cdm_fu
cdm_fu[, enriched_plant]
dif_top
enriched_plant
enriched_plant <- na.omit(enriched_plant)
enriched_plant <- unique(c(enriched_endo, enriched_root))
enriched_plant <- na.omit(enriched_plant)
endo_tab <- cbind(order = as.character(tax_fu[enriched_plant, "order"]),
  ASV = paste(gsub("_", " ", tax_fu[enriched_plant, "species"]), enriched_plant))
x <- cdm_fu[, enriched_plant]
x <- apply(x, 2, function(x) tapply(x, sample_fu$species, sum))
x[x > 0] <- 1
x <- t(x)
endo_tab <- cbind(endo_tab, x)
endo_tab <- as.data.frame(endo_tab)
endo_tab$in_rhizoplane <- as.numeric(enriched_plant %in% enriched_root)
endo_tab$in_endosphere <- as.numeric(enriched_plant %in% enriched_endo)
write.table(endo_tab, "output/endo_tab_fu.csv", col.names = NA, sep = ";")
enriched_plant
pdf("output/orders_enrich_fu2.pdf", w = 2.4, h = 2.1, pointsize = 12)
par(mar = c(4, 4, 1, 1), xpd = T, tck = -0.03, mgp = c(1.5, 0.5, 0))
barplot(tab, las = 1, col = col_order_fu, ylab = "Proportion", border = NA,
  space = c(0.1, 0.1, 0.1, 0.3, 0.1, 0.1))
dev.off()
pdf("output/venn_fu2.pdf", w = 4, h = 2, pointsize = 12)
par(mfrow = c(1, 2), mar = rep(1, 4))
venn(na.omit(dif_top))
venn(na.omit(dif_low))
dev.off()
enriched_endo
enriched_root
enriched_plant
enriched_endo
dif_top$endosphere
enriched_endo
xe
enriched_endo <- na.omit(rownames(dif_top)[dif_top$endosphere])enriched_endo <- na.omit(rownames(dif_top)[dif_top$endosphere])
enriched_endo <- na.omit(rownames(dif_top)[dif_top$endosphere])
enriched_endo
enriched_endo <- na.omit(rownames(dif_top)[dif_top$endosphere])
enriched_root <- na.omit(rownames(dif_top)[dif_top$root])
enriched_rhizo <- na.omit(rownames(dif_top)[dif_top$rhizosphere])
depleted_endo <- na.omit(rownames(dif_low)[dif_low$endosphere])
depleted_root <- na.omit(rownames(dif_low)[dif_low$root])
depleted_rhizo <- na.omit(rownames(dif_low)[dif_low$rhizosphere])
xe <- table(tax_fu[enriched_endo, "order"])
xe <- xe * 100 / sum(xe)
xr <- table(tax_fu[enriched_root, "order"])
xr <- xr * 100 / sum(xr)
xrh <- table(tax_fu[enriched_rhizo, "order"])
xrh <- xrh * 100 / sum(xrh) 
ye <- table(tax_fu[depleted_endo, "order"])
ye <- ye * 100 / sum(ye)
yr <- table(tax_fu[depleted_root, "order"])
yr <- yr * 100 / sum(yr)
yrh <- table(tax_fu[depleted_rhizo, "order"])
yrh <- yrh * 100 / sum(yrh)
z <- cbind(Erh = xrh, Er = xr, Ee = xe, Drh = yrh, Dr = yr, De = ye)
tab <- z[rownames(z) %in% colnames(order_tab_fu), ] 
tab <- rbind(tab, others = colSums(z[!(rownames(z) %in%
  colnames(order_tab_fu)), ]))
tab <- tab[colnames(order_tab_fu), ]
pdf("output/orders_enrich_fu2.pdf", w = 2.4, h = 2.1, pointsize = 12)
par(mar = c(4, 4, 1, 1), xpd = T, tck = -0.03, mgp = c(1.5, 0.5, 0))
barplot(tab, las = 1, col = col_order_fu, ylab = "Proportion", border = NA,
  space = c(0.1, 0.1, 0.1, 0.3, 0.1, 0.1))
dev.off()
enriched_plant <- unique(c(enriched_endo, enriched_root))
enriched_plant <- na.omit(enriched_plant)
endo_tab <- cbind(order = as.character(tax_fu[enriched_plant, "order"]),
  ASV = paste(gsub("_", " ", tax_fu[enriched_plant, "species"]), enriched_plant))
x <- cdm_fu[, enriched_plant]
x <- apply(x, 2, function(x) tapply(x, sample_fu$species, sum))
x[x > 0] <- 1
x <- t(x)
endo_tab <- cbind(endo_tab, x)
endo_tab <- as.data.frame(endo_tab)
endo_tab$in_rhizoplane <- as.numeric(enriched_plant %in% enriched_root)
endo_tab$in_endosphere <- as.numeric(enriched_plant %in% enriched_endo)
write.table(endo_tab, "output/endo_tab_fu.csv", col.names = NA, sep = ";")
dif_top
dif_top <- na.omit(dif_coeff > 0 & dif_pval <= p_cutoff)
dif_low <- na.omit(dif_coeff < 0 & dif_pval <= p_cutoff)
pdf("output/venn_fu2.pdf", w = 4, h = 2, pointsize = 12)
par(mfrow = c(1, 2), mar = rep(1, 4))
venn(na.omit(dif_top))
venn(na.omit(dif_low))
dev.off()
dif_top <- as.data.frame(dif_top)
dif_low <- as.data.frame(dif_low)
enriched_endo <- na.omit(rownames(dif_top)[dif_top$endosphere])
enriched_root <- na.omit(rownames(dif_top)[dif_top$root])
enriched_rhizo <- na.omit(rownames(dif_top)[dif_top$rhizosphere])
depleted_endo <- na.omit(rownames(dif_low)[dif_low$endosphere])
depleted_root <- na.omit(rownames(dif_low)[dif_low$root])
depleted_rhizo <- na.omit(rownames(dif_low)[dif_low$rhizosphere])
xe <- table(tax_fu[enriched_endo, "order"])
xe <- xe * 100 / sum(xe)
xr <- table(tax_fu[enriched_root, "order"])
xr <- xr * 100 / sum(xr)
xrh <- table(tax_fu[enriched_rhizo, "order"])
xrh <- xrh * 100 / sum(xrh) 
ye <- table(tax_fu[depleted_endo, "order"])
ye <- ye * 100 / sum(ye)
yr <- table(tax_fu[depleted_root, "order"])
yr <- yr * 100 / sum(yr)
yrh <- table(tax_fu[depleted_rhizo, "order"])
yrh <- yrh * 100 / sum(yrh)
z <- cbind(Erh = xrh, Er = xr, Ee = xe, Drh = yrh, Dr = yr, De = ye)
tab <- z[rownames(z) %in% colnames(order_tab_fu), ] 
tab <- rbind(tab, others = colSums(z[!(rownames(z) %in%
  colnames(order_tab_fu)), ]))
tab <- tab[colnames(order_tab_fu), ]
pdf("output/orders_enrich_fu2.pdf", w = 2.4, h = 2.1, pointsize = 12)
par(mar = c(4, 4, 1, 1), xpd = T, tck = -0.03, mgp = c(1.5, 0.5, 0))
barplot(tab, las = 1, col = col_order_fu, ylab = "Proportion", border = NA,
  space = c(0.1, 0.1, 0.1, 0.3, 0.1, 0.1))
dev.off()
xe <- table(tax_fu[enriched_endo, "order"])
xe <- xe * 100 / sum(xe)
xr <- table(tax_fu[enriched_root, "order"])
xr <- xr * 100 / sum(xr)
xrh <- table(tax_fu[enriched_rhizo, "order"])
xrh <- xrh * 100 / sum(xrh) 
ye <- table(tax_fu[depleted_endo, "order"])
ye <- ye * 100 / sum(ye)
yr <- table(tax_fu[depleted_root, "order"])
yr <- yr * 100 / sum(yr)
yrh <- table(tax_fu[depleted_rhizo, "order"])
yrh <- yrh * 100 / sum(yrh)
z <- cbind(Erh = xrh, Er = xr, Ee = xe, Drh = yrh, Dr = yr, De = ye)
tab <- z[rownames(z) %in% colnames(order_tab_fu), ] 
tab <- rbind(tab, others = colSums(z[!(rownames(z) %in%
  colnames(order_tab_fu)), ]))
tab <- tab[colnames(order_tab_fu), ]
pdf("output/orders_enrich_fu2.pdf", w = 2.4, h = 2.1, pointsize = 12)
par(mar = c(4, 4, 1, 1), xpd = T, tck = -0.03, mgp = c(1.5, 0.5, 0))
barplot(tab, las = 1, col = col_order_fu, ylab = "Proportion", border = NA,
  space = c(0.1, 0.1, 0.1, 0.3, 0.1, 0.1))
dev.off()
enriched_plant <- unique(c(enriched_endo, enriched_root))
enriched_plant <- na.omit(enriched_plant)
endo_tab <- cbind(order = as.character(tax_fu[enriched_plant, "order"]),
  ASV = paste(gsub("_", " ", tax_fu[enriched_plant, "species"]), enriched_plant))
x <- cdm_fu[, enriched_plant]
x <- apply(x, 2, function(x) tapply(x, sample_fu$species, sum))
x[x > 0] <- 1
x <- t(x)
endo_tab <- cbind(endo_tab, x)
endo_tab <- as.data.frame(endo_tab)
endo_tab$in_rhizoplane <- as.numeric(enriched_plant %in% enriched_root)
endo_tab$in_endosphere <- as.numeric(enriched_plant %in% enriched_endo)
write.table(endo_tab, "output/endo_tab_fu.csv", col.names = NA, sep = ";")
dif_top <- na.omit(dif_coeff > 0 & dif_pval <= p_cutoff)
dif_low <- na.omit(dif_coeff < 0 & dif_pval <= p_cutoff)
dif_topdif_top
dif_top
dif_top <- dif_coeff > 0 & dif_pval <= p_cutoff
dif_low <- dif_coeff < 0 & dif_pval <= p_cutoff
dif_top
head(dif_top)
dif_top[is.na(dif_top)]dif_top[is.na(dif_top)]
dif_top[is.na(dif_top)]
dif_top[is.na(dif_top)] <- F
dif_top[is.na(dif_top)] <- F
dif_low[is.na(dif_low)] <- F
dif_low
pdf("output/venn_fu2.pdf", w = 4, h = 2, pointsize = 12)
par(mfrow = c(1, 2), mar = rep(1, 4))
venn(dif_top)
venn(dif_low)
dev.off()
dif_top <- as.data.frame(dif_top)
dif_low <- as.data.frame(dif_low)
enriched_endo <- na.omit(rownames(dif_top)[dif_top$endosphere])
enriched_root <- na.omit(rownames(dif_top)[dif_top$root])
enriched_rhizo <- na.omit(rownames(dif_top)[dif_top$rhizosphere])
depleted_endo <- na.omit(rownames(dif_low)[dif_low$endosphere])
depleted_root <- na.omit(rownames(dif_low)[dif_low$root])
depleted_rhizo <- na.omit(rownames(dif_low)[dif_low$rhizosphere])
xe <- table(tax_fu[enriched_endo, "order"])
xe <- xe * 100 / sum(xe)
xr <- table(tax_fu[enriched_root, "order"])
xr <- xr * 100 / sum(xr)
xrh <- table(tax_fu[enriched_rhizo, "order"])
xrh <- xrh * 100 / sum(xrh) 
ye <- table(tax_fu[depleted_endo, "order"])
ye <- ye * 100 / sum(ye)
yr <- table(tax_fu[depleted_root, "order"])
yr <- yr * 100 / sum(yr)
yrh <- table(tax_fu[depleted_rhizo, "order"])
yrh <- yrh * 100 / sum(yrh)
z <- cbind(Erh = xrh, Er = xr, Ee = xe, Drh = yrh, Dr = yr, De = ye)
tab <- z[rownames(z) %in% colnames(order_tab_fu), ] 
tab <- rbind(tab, others = colSums(z[!(rownames(z) %in%
  colnames(order_tab_fu)), ]))
tab <- tab[colnames(order_tab_fu), ]
pdf("output/orders_enrich_fu2.pdf", w = 2.4, h = 2.1, pointsize = 12)
par(mar = c(4, 4, 1, 1), xpd = T, tck = -0.03, mgp = c(1.5, 0.5, 0))
barplot(tab, las = 1, col = col_order_fu, ylab = "Proportion", border = NA,
  space = c(0.1, 0.1, 0.1, 0.3, 0.1, 0.1))
dev.off()
enriched_plant <- unique(c(enriched_endo, enriched_root))
enriched_plant <- na.omit(enriched_plant)
endo_tab <- cbind(order = as.character(tax_fu[enriched_plant, "order"]),
  ASV = paste(gsub("_", " ", tax_fu[enriched_plant, "species"]), enriched_plant))
x <- cdm_fu[, enriched_plant]
x <- apply(x, 2, function(x) tapply(x, sample_fu$species, sum))
x[x > 0] <- 1
x <- t(x)
endo_tab <- cbind(endo_tab, x)
endo_tab <- as.data.frame(endo_tab)
endo_tab$in_rhizoplane <- as.numeric(enriched_plant %in% enriched_root)
endo_tab$in_endosphere <- as.numeric(enriched_plant %in% enriched_endo)
write.table(endo_tab, "output/endo_tab_fu.csv", col.names = NA, sep = ";")
write.table(dif_abund_fu, "output/dif_abund_fu.csv", sep = ";", col.names = NA)
dif_abund_fu$logcoef <- log10(as.numeric(dif_abund_fu$coef) + 1000) - 3
head(dif_abund_fu)
sel <- dif_abund_fu[dif_abund_fu$comp == "endosphere", ]
sel <- na.omit(sel)
col <- rep("gray", nrow(sel))
col[x$Padj < 0.01] <- "red"
col[is.na(col)] <- "gray"
sel <- dif_abund_fu[dif_abund_fu$comp == "endosphere", ]
sel <- na.omit(sel)
col <- rep("gray", nrow(sel))
col[dif_abund_fu$Padj < 0.01] <- "red"
col[is.na(col)] <- "gray"
plot(sel$logcoef ~ sel$logreads, pch = 16, cex = 0.3, col = col)
sel <- dif_abund_fu[dif_abund_fu$comp == "root", ]
sel <- na.omit(sel)
col <- rep("gray", nrow(sel))
col[dif_abund_fu$Padj < 0.01] <- "red"
col[is.na(col)] <- "gray"
plot(sel$logcoef ~ sel$logreads, pch = 16, cex = 0.3, col = col)
dif_abund_oo <- dif_abund(cdm_oo, sample_oo)
write.table(dif_abund_oo, "output/dif_abund_oo.csv", sep = ";", col.names = NA)
dif_abund_oo[dif_abund_oo$Padj < 0.001, ]
#x <- na.omit(x)
nrow(dif_abund_oo)
nrow(dif_abund_oo[dif_abund_oo$comp == "endosphere", ])
nrow(dif_abund_oo[dif_abund_oo$comp == "endosphere" & as.numeric(dif_abund_oo$coef) > 0, ])
nrow(dif_abund_oo[dif_abund_oo$comp == "root" & as.numeric(dif_abund_oo$coef) > 0, ])
nrow(dif_abund_oo[dif_abund_oo$comp == "endosphere" & as.numeric(dif_abund_oo$coef) < 0, ])
nrow(dif_abund_oo[dif_abund_oo$comp == "root" & as.numeric(dif_abund_oo$coef) < 0, ])
p_cutoff <- 0.01
x <- dif_abund_oo[dif_abund_oo$Padj <= p_cutoff, ]
x_endo_h <- x[x$comp == "endosphere" & x$coef > 0, ]
x_endo_l <- x[x$comp == "endosphere" & x$coef < 0, ]
x_root_h <- x[x$comp == "root" & x$coef > 0, ]
x_root_l <- x[x$comp == "root" & x$coef < 0, ]
x_rhizo_h <- x[x$comp == "rhizosphere" & x$coef > 0, ]
x_rhizo_l <- x[x$comp == "rhizosphere" & x$coef < 0, ]
dif_coeff <- data.frame(
  rhizosphere = as.numeric(dif_abund_oo[dif_abund_oo$comp == "rhizosphere",
  "coef"]), root = as.numeric(dif_abund_oo[dif_abund_oo$comp == "root",
  "coef"]), endosphere = as.numeric(dif_abund_oo[dif_abund_oo$comp ==
  "endosphere", "coef"]))
dif_coeff <- as.matrix(dif_coeff)
rownames(dif_coeff) <- unique(dif_abund_oo$ASV)
dif_pval <- data.frame(
  rhizosphere = as.numeric(dif_abund_oo[dif_abund_oo$comp == "rhizosphere",
  "Padj"]), root = as.numeric(dif_abund_oo[dif_abund_oo$comp == "root",
  "Padj"]), endosphere = as.numeric(dif_abund_oo[dif_abund_oo$comp ==
  "endosphere", "Padj"]))
dif_pval <- as.matrix(dif_pval)
rownames(dif_pval) <- unique(dif_abund_oo$ASV)
dif_top <- dif_coeff > 0 & dif_pval <= p_cutoff
dif_low <- dif_coeff < 0 & dif_pval <= p_cutoff
dif_top[is.na(dif_top)] <- F
dif_low[is.na(dif_low)] <- F
pdf("output/venn_oo2.pdf", w = 4, h = 2, pointsize = 12)
par(mfrow = c(1, 2), mar = rep(1, 4))
venn(dif_top)
venn(dif_low)
dev.off()
dif_top <- as.data.frame(dif_top)
dif_low <- as.data.frame(dif_low)
enriched_endo <- rownames(dif_top)[dif_top$endosphere]
enriched_root <- rownames(dif_top)[dif_top$root]
enriched_rhizo <- rownames(dif_top)[dif_top$rhizosphere]
depleted_endo <- rownames(dif_low)[dif_low$endosphere]
depleted_root <- rownames(dif_low)[dif_low$root]
depleted_rhizo <- rownames(dif_low)[dif_low$rhizosphere]
xe <- table(tax_oo[enriched_endo, "order"])
xe <- xe * 100 / sum(xe)
xr <- table(tax_oo[enriched_root, "order"])
xr <- xr * 100 / sum(xr)
xrh <- table(tax_oo[enriched_rhizo, "order"])
xrh <- xrh * 100 / sum(xrh) 
ye <- table(tax_oo[depleted_endo, "order"])
ye <- ye * 100 / sum(ye)
yr <- table(tax_oo[depleted_root, "order"])
yr <- yr * 100 / sum(yr)
yrh <- table(tax_oo[depleted_rhizo, "order"])
yrh <- yrh * 100 / sum(yrh)
z <- cbind(Erh = xrh, Er = xr, Ee = xe, Drh = yrh, Dr = yr, De = ye)
tab <- z[rownames(z) %in% colnames(order_tab_oo), ] 
tab <- rbind(tab, others = colSums(z[!(rownames(z) %in%
  colnames(order_tab_oo)), ]))
tab <- tab[colnames(order_tab_oo), ]
pdf("output/orders_enrich_oo2.pdf", w = 2.4, h = 2.1, pointsize = 12)
par(mar = c(4, 4, 1, 1), xpd = T, tck = -0.03, mgp = c(1.5, 0.5, 0))
barplot(tab, las = 1, col = col_order_oo, ylab = "Proportion", border = NA,
  space = c(0.1, 0.1, 0.1, 0.3, 0.1, 0.1))
dev.off()
enriched_plant <- unique(c(enriched_endo, enriched_root))
endo_tab <- cbind(order = as.character(tax_oo[enriched_plant, "order"]),
  ASV = paste(gsub("_", " ", tax_oo[enriched_plant, "species"]), enriched_plant))
x <- cdm_oo[, enriched_plant]
x <- apply(x, 2, function(x) tapply(x, sample_oo$species, sum))
x[x > 0] <- 1
x <- t(x)
endo_tab <- cbind(endo_tab, x)
endo_tab <- as.data.frame(endo_tab)
endo_tab$in_rhizoplane <- as.numeric(enriched_plant %in% enriched_root)
endo_tab$in_endosphere <- as.numeric(enriched_plant %in% enriched_endo)
write.table(endo_tab, "output/endo_tab_oo.csv", col.names = NA, sep = ";")
q()
